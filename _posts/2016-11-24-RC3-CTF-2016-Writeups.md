---
layout: post
title: RC3 CTF 2016 Writeups
published: false
---

Last weekend [RIT Competitive Cybersecurity Club](https://rc3.club/) hosted [RC3 CTF](https://ctftime.org/event/389). All in all it was a 
great competition and a very stimulating learning experience. Below are the writeups for some of the challenges that I solved.

**[Salad](#salad)**

**[Some Pang](#some-pang)**

**[Bridge of Cyber](#bridge-of-cyber)**

**[Klaatu Barada N...](#klaatu-barada-n)**

---

## Salad 

> 100 points
>
> “The fault, dear Brutus, is not in our stars, but in ourselves.” (I.ii.141) Julius Caesar in William Shakespeare’s Julius Caesar
>
> Cipher Text: 7sj-ighm-742q3w4t

Right off the bat there are a lot of clues to how the flag is encoded. The Caesar quote and challenge name both point to [Caesar cipher](https://en.wikipedia.org/wiki/Caesar_cipher). Also we know that the flags are in format ```RC3-2016-xxx```, so the first two sections of the encoded flag are likely ```RC3-2016-```.

Let's try substituting letters and numbers from that section into a simple encoding table:

```
0123456789 ABCDEFGHIJKLMNOPQRSTUVWXYZ
ghij  m      s              7
```

We can see a pattern developing, so let's fill out the rest of the table:

```
0123456789 ABCDEFGHIJKLMNOPQRSTUVWXYZ
ghijklmnop qrstuvwxyz0123456789abcdef
```

We can now decode the flag: ```RC3-2016-ROMANGOD```.

---

## Some Pang

> 50 points
>
> we captured some iseeempee pang pakets. do the thing. get the flag. win the POINTS!
> Download Link: here
>
> author: wumb0

The zip file that comes with the challenge contains a PCAP file ```somepang.pcap```. Once we open it in [Wirehark](https://www.wireshark.org/) we see a bunch of ICMP packets. The send and receive packets look identical. The data fields of the packets contain some kind of character sequence, with 2 characters being repeated 12 times:

![Wireshark screencap]({{ site.baseurl }}/ctfs/rc3ctf2016/somepang/wireshark.png)

When we scroll to the end of the PCAP file we see that the last packet contains sequence ```==```, which likely indicates that a large base64-encoded blob is being transmitted:

![Wireshark screencap 2]({{ site.baseurl }}/ctfs/rc3ctf2016/somepang/wireshark2.png)

Let's use [tshark](https://www.wireshark.org/docs/man-pages/tshark.html) to extract data from either send or receive part of the conversation:

```
root@kali:~/rc3# tshark -r somepang.pcap -T fields -e data.data -Y "ip.dst eq 192.168.1.198" > out.txt
```

The output is in the following format:

```
2f:39:2f:39:2f:39:2f:39:2f:39:2f:39:2f:39:2f:39:2f:39:2f:39:2f:39:2f:39
6a:2f:6a:2f:6a:2f:6a:2f:6a:2f:6a:2f:6a:2f:6a:2f:6a:2f:6a:2f:6a:2f:6a:2f
34:41:34:41:34:41:34:41:34:41:34:41:34:41:34:41:34:41:34:41:34:41:34:41
...
```

We then put together and run a small script that decodes last 2 characters in each line of the file, combines all characters, and base64-decodes them into an output file:

```python
import base64

str = ""
with open("out.txt") as f:
	for x in f.readlines():
		b1,b2 = x.strip().split(':')[-2:]
		str += chr(int(b1, 16)) + chr(int(b2, 16))
				
with open("out.dat", "wb") as o:
	o.write(base64.b64decode(str))
```

The output file turns out to be a JPEG:

```
root@kali:~/rc3# file out.dat
out.dat: JPEG image data, JFIF standard 1.01, aspect ratio, density 72x72, segment length 16, Exif Standard: [TIFF image data, big-endian, direntries=2, orientation=upper-left], baseline, precision 8, 720x449, frames 3
```

When we rename and open it we see that it contains the flag: ```RC3-2016-PANG-ME-LIKE-ONE-OF-YOUR-FRENCH-GORILLAZ```

![Solution]({{ site.baseurl }}/ctfs/rc3ctf2016/somepang/out.jpg)

---

## Bridge of Cyber

> 200 points
>
> Welcome to the "Bridge of Cyber"! It's the same concept as the "Bridge of Death" in Holy Grail. Our DNS servers aren't very good at their job because they ask more questions then they answer. Let's see if you can get the flag from our DNS.
>
>Nameserver: ns-920.awsdns-51.net
>
>Domain: misc200.ctf.rc3.club

I watched [Monty Python and the Holy Grail](http://www.imdb.com/title/tt0071853/) a **long** time ago so I carefully reviewed a ["Bridge of Death" clip](https://www.youtube.com/watch?v=cV0tCphFMr8) before proceeding.

This is a DNS challenge, so let's use [dig](https://en.wikipedia.org/wiki/Dig_%28command%29) to query the nameserver. The hints section also suggested this approach, and emphasized *subdomains*.

```
root@kali:~# dig any @ns-920.awsdns-51.net misc200.ctf.rc3.club

; <<>> DiG 9.10.3-P4-Debian <<>> any @ns-920.awsdns-51.net misc200.ctf.rc3.club
; (2 servers found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 39248
;; flags: qr aa rd; QUERY: 1, ANSWER: 6, AUTHORITY: 0, ADDITIONAL: 1
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;misc200.ctf.rc3.club.		IN	ANY

;; ANSWER SECTION:
misc200.ctf.rc3.club.	172800	IN	NS	ns-1526.awsdns-62.org.
misc200.ctf.rc3.club.	172800	IN	NS	ns-1842.awsdns-38.co.uk.
misc200.ctf.rc3.club.	172800	IN	NS	ns-489.awsdns-61.com.
misc200.ctf.rc3.club.	172800	IN	NS	ns-920.awsdns-51.net.
misc200.ctf.rc3.club.	900	IN	SOA	ns-1526.awsdns-62.org. awsdns-hostmaster.amazon.com. 1 7200 900 1209600 86400
misc200.ctf.rc3.club.	300	IN	TXT	"What is the air-speed velocity of an unladen swallow"

;; Query time: 31 msec
;; SERVER: 205.251.195.152#53(205.251.195.152)
;; WHEN: Tue Nov 22 12:13:58 EST 2016
;; MSG SIZE  rcvd: 315
```

Notice that the TXT field contains the question from the movie. The answer is ```"What do you mean? An African or European swallow?"```. After trying a lot of different combinations of these words as the name of subdomain of ```misc200.ctf.rc3.club``` we finally get the following answer:

```
root@kali:~# dig any @ns-920.awsdns-51.net african.misc200.ctf.rc3.club
...
african.misc200.ctf.rc3.club. 300 IN	TXT	"Why was the developer broke? He spent all of his"
```

Googling this joke we find the answer - ```cache``` - and prepend it to the name. 

Several more questions and answers follow and we finally get this:

```
root@kali:~# dig any @ns-920.awsdns-51.net 1forrest1.penaltea.fsh.phishing.firewall.cache.african.misc200.ctf.rc3.club
...
1forrest1.penaltea.fsh.phishing.firewall.cache.african.misc200.ctf.rc3.club. 300 IN TXT	"Welp this is a depressing their is no flag here I guess your swallow was just to slow"
```

Son of a... :-) Ok, let's try ```european``` as the first answer. Some more questions and answers later we finally get the flag: ```RC3-2016-cyb3rxr05```

```
root@kali:~# dig any @ns-920.awsdns-51.net time.tomorrow.pi.european.misc200.ctf.rc3.club
...
time.tomorrow.pi.european.misc200.ctf.rc3.club.	300 IN SPF "RC3-2016-cyb3rxr05"
```

---

## Klaatu Barada N...

> 300 points
>
> Whilst fighting of hordes of Deadites, Ash seems to have forgotten something. Help Ash remember the words, because he'd rather be in Jacksonville.
>
> nc ctf.rc3.club 6050
>
> author:orkulus

"Klaatu Barada Nikto", as it turns out, is a phrase from both [The Day the Earth Stood Still](http://www.imdb.com/title/tt0043456/) and [Army of Darkness](http://www.imdb.com/title/tt0106308/) (CTFs teach you all kinds of trivia :) ). 

The application that we connect to returns a bunch of base64-encoded strings and immediately disconnects. It does not seem to accept any input, so let's proceed on assumption that the flag is encoded in the output. 

The application output changes all the time both in content and in the number of lines returned. However all lines seem to be quotes from "Army of Darkness", and there is a limited set of them. We also notice that the most frequently returned number of lines is 136, which **divides by 8**. So there is a possibility that each line encodes a single bit of data, and 8 lines represent a single character from the flag. Let's verify that.

We capture a sample output, decode and save it into a local file [nikto.txt]({{ site.baseurl }}/ctfs/rc3ctf2016/klaatu-barada-n/nikto.txt). Let's massage it to get a list of unique quotes to work with:

```
root@kali:~/rc3# cat nikto.txt | uniq | sort > nikto_table.txt
```

Now we look at the first 8 lines in ```nikto.txt```:

```
Look, maybe I didn't say every single little tiny syllable, no. But basically I said them, yeah.
I may be bad... but I feel gooood.
Good. Bad. I'm the guy with the gun.
Groovy.
Yo, she-bitch! Let's go!
Oh, you wanna know? 'Cause the answer's easy! I'm BAD Ash... and you're GOOD Ash! You're a goody little two-shoes! Little goody two-shoes! Little goody two-shoes!
I may be bad... but I feel gooood.
Shut up, Linda!
```

If our theory is correct, they are encoding the first letter in ```RC3-2016-xxx```. Letter ```R``` is binary ```01010010```. Let's mark corresponding quotes in ```nikto_table.txt``` with either ```0``` or ```1```:

```
0	Look, maybe I didn't say every single little tiny syllable, no. But basically I said them, yeah.
1	I may be bad... but I feel gooood.
0	Good. Bad. I'm the guy with the gun.
1	Groovy.
0	Yo, she-bitch! Let's go!
0	Oh, you wanna know? 'Cause the answer's easy! I'm BAD Ash... and you're GOOD Ash! You're a goody little two-shoes! Little goody two-shoes! Little goody two-shoes!
0	Shut up, Linda!
```

We then repeat the same process for remaining characters in ```RC3-2016-```. The result can be seen in [nikto_table.txt]({{ site.baseurl }}/ctfs/rc3ctf2016/klaatu-barada-n/nikto_table.txt).

Now let's use these two files to try and decode the flag using the following script:

```python
import binascii

xtable = {}
with open("nikto_table.txt") as f:
	for x in f.readlines():
		bit, line = x.strip().split('\t')
		xtable[line] = bit
		
bitstr = '0b'
with open("nikto.txt") as f:
	for x in f.readlines():
		bitstr += xtable[x.strip()]
		
n = int(bitstr, 2)

print binascii.unhexlify('%x' % n)
```

We run the script and get the flag: ```RC3-2016-CHRLSD3D```
```
root@kali:~/rc3# python nikto.py
RC3-2016-CHRLSD3D
```
